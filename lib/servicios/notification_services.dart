import 'package:flutter_local_notifications/flutter_local_notifications.dart';
import 'package:timezone/data/latest.dart' as tz_data;
import 'package:timezone/timezone.dart' as tz;

final FlutterLocalNotificationsPlugin flutterLocalNotificationsPlugin =
    FlutterLocalNotificationsPlugin();

// Inicializaci√≥n de las notificaciones para Android
Future<void> initNotificactions() async {
  tz_data.initializeTimeZones();  // Inicializa las zonas horarias

  const AndroidInitializationSettings initializationSettingsAndroid =
      AndroidInitializationSettings('icono_notificacion'); // Aseg√∫rate de tener el icono

  const InitializationSettings initializationSettings = InitializationSettings(
    android: initializationSettingsAndroid,
  );

  await flutterLocalNotificationsPlugin.initialize(initializationSettings);
}

// Funci√≥n para mostrar una notificaci√≥n simple
Future<void> mostrarNotificacion() async {
  const AndroidNotificationDetails androidNotificationDetails =
      AndroidNotificationDetails(
    'yout_channel_id',
    'your_channel_name',
    importance: Importance.max,
    priority: Priority.high,
  );

  const NotificationDetails notificationDetails = NotificationDetails(
    android: androidNotificationDetails,
  );

  await flutterLocalNotificationsPlugin.show(
    1, // ID √∫nico
    'Registro creado',
    'Tu registro se agreg√≥ exitosamente',
    notificationDetails,
  );
}

// Funci√≥n para programar notificaci√≥n en una zona horaria espec√≠fica
Future<void> programarNotificacion(DateTime time) async {
  final location = tz.getLocation('America/Mexico_City');
  final tzTime = tz.TZDateTime.from(time, location); // Convierte la hora a TZDateTime

  const AndroidNotificationDetails androidNotificationDetails =
      AndroidNotificationDetails(
    'yout_channel_id',
    'your_channel_name',
    importance: Importance.max,
    priority: Priority.high,
  );

  const NotificationDetails notificationDetails = NotificationDetails(
    android: androidNotificationDetails,
  );

  await flutterLocalNotificationsPlugin.zonedSchedule(
    1, // ID √∫nico para la notificaci√≥n
    'Registro creado',
    'Tu registro se agreg√≥ exitosamente',
    tzTime, // Hora programada con zona horaria
    notificationDetails,
    androidScheduleMode: AndroidScheduleMode.exactAllowWhileIdle,
    uiLocalNotificationDateInterpretation:
        UILocalNotificationDateInterpretation.wallClockTime,
    matchDateTimeComponents: DateTimeComponents.time,
  );
}

// Funci√≥n para programar una notificaci√≥n diaria a las 11:00 AM (o la hora seleccionada)
Future<void> programarNotificacionRespirar(DateTime time) async {
  final location = tz.getLocation('America/Argentina/Buenos_Aires');
  final tzTime = tz.TZDateTime.from(time, location); // Convertir DateTime a TZDateTime

  const AndroidNotificationDetails androidNotificationDetails =
      AndroidNotificationDetails(
    'yout_channel_id',
    'your_channel_name',
    importance: Importance.max,
    priority: Priority.high,
  );

  const NotificationDetails notificationDetails = NotificationDetails(
    android: androidNotificationDetails,
  );

  await flutterLocalNotificationsPlugin.zonedSchedule(
    2, // ID √∫nico
    'Momento de autocuidado',
    'Tomarte un momento para respirar profundamente es un acto de autocuidado. ¬°Hazlo ahora! üå¨Ô∏èüíÜ‚Äç‚ôÄÔ∏è',
    tzTime, // Hora programada con zona horaria
    notificationDetails,
    androidScheduleMode: AndroidScheduleMode.exactAllowWhileIdle,
    uiLocalNotificationDateInterpretation:
        UILocalNotificationDateInterpretation.wallClockTime,
    matchDateTimeComponents: DateTimeComponents.time,
  );
}

// Funci√≥n para programar una notificaci√≥n diaria a las 3:00 PM (o la hora seleccionada)
Future<void> programarNotificacionPausa(DateTime time) async {
  final location = tz.getLocation('America/Argentina/Buenos_Aires');
  final tzTime = tz.TZDateTime.from(time, location); // Convertir DateTime a TZDateTime

  const AndroidNotificationDetails androidNotificationDetails =
      AndroidNotificationDetails(
    'yout_channel_id',
    'your_channel_name',
    importance: Importance.max,
    priority: Priority.high,
  );

  const NotificationDetails notificationDetails = NotificationDetails(
    android: androidNotificationDetails,
  );

  await flutterLocalNotificationsPlugin.zonedSchedule(
    3, // ID √∫nico
    'Haz una pausa',
    'A veces el mejor cuidado es simplemente detenerte y respirar. üå∏üíÜ‚Äç‚ôÇÔ∏è',
    tzTime, // Hora programada con zona horaria
    notificationDetails,
    androidScheduleMode: AndroidScheduleMode.exactAllowWhileIdle,
    uiLocalNotificationDateInterpretation:
        UILocalNotificationDateInterpretation.wallClockTime,
    matchDateTimeComponents: DateTimeComponents.time,
  );
}

// Funci√≥n para programar una notificaci√≥n diaria a las 6:00 PM (o la hora seleccionada)
Future<void> programarNotificacionReflexion(DateTime time) async {
  final location = tz.getLocation('America/Mexico_City');
  final tzTime = tz.TZDateTime.from(time, location); // Convertir DateTime a TZDateTime

  const AndroidNotificationDetails androidNotificationDetails =
      AndroidNotificationDetails(
    'yout_channel_id',
    'your_channel_name',
    importance: Importance.max,
    priority: Priority.high,
  );

  const NotificationDetails notificationDetails = NotificationDetails(
    android: androidNotificationDetails,
  );

  await flutterLocalNotificationsPlugin.zonedSchedule(
    5, // ID √∫nico
    'Hoy, reflexionemos juntos',
    'Hoy, reflexionemos juntos. üå∏ ¬øQu√© te hace sentir bien en este momento? Puedo ayudarte a encontrar maneras de nutrir esa sensaci√≥n.',
    tzTime, // Hora programada con zona horaria
    notificationDetails,
    androidScheduleMode: AndroidScheduleMode.exactAllowWhileIdle,
    uiLocalNotificationDateInterpretation:
        UILocalNotificationDateInterpretation.wallClockTime,
    matchDateTimeComponents: DateTimeComponents.time,
  );
}

// Funci√≥n para programar una notificaci√≥n diaria a las 7:00 PM (o la hora seleccionada)
Future<void> programarNotificacionMeditar(DateTime time) async {
  final location = tz.getLocation('America/Argentina/Buenos_Aires');
  final tzTime = tz.TZDateTime.from(time, location); // Convertir DateTime a TZDateTime

  const AndroidNotificationDetails androidNotificationDetails =
      AndroidNotificationDetails(
    'yout_channel_id',
    'your_channel_name',
    importance: Importance.max,
    priority: Priority.high,
  );

  const NotificationDetails notificationDetails = NotificationDetails(
    android: androidNotificationDetails,
  );

  await flutterLocalNotificationsPlugin.zonedSchedule(
    6, // ID √∫nico
    'Reduce el estr√©s con meditaci√≥n',
    '¬øSab√≠as que meditar solo 5 minutos puede ayudarte a reducir el estr√©s? üßò‚Äç‚ôÄÔ∏è Si te interesa, puedo guiarte en una breve sesi√≥n.',
    tzTime, // Hora programada con zona horaria
    notificationDetails,
    androidScheduleMode: AndroidScheduleMode.exactAllowWhileIdle,
    uiLocalNotificationDateInterpretation:
        UILocalNotificationDateInterpretation.wallClockTime,
    matchDateTimeComponents: DateTimeComponents.time,
  );
}


// Llamar las funciones para programar todas las notificaciones con las horas seleccionadas
void programarTodasLasNotificaciones(DateTime timeRespirar, DateTime timePausa, DateTime timeReflexion, DateTime timeMeditar) {
  programarNotificacion(DateTime(2024, 11, 17, 9, 0, 0)); // 9:00 AM
  programarNotificacionRespirar(timeRespirar);  
  programarNotificacionPausa(timePausa);      
  programarNotificacionReflexion(timeReflexion);  
  programarNotificacionMeditar(timeMeditar);  
}